{% extends "admin/base.html" %}
{% block content %}
<h2>Medicine Inventory</h2>

<!-- Filter Form -->
<form method="get">
  {{ filter.form.as_p }}
  <button type="submit">Filter</button>
  <a href="{% url 'list_medicine' %}">Reset</a>
</form>

<!-- Print Button -->
<button onclick="printTable()">Print</button>

<!-- Table -->
<div id="medicine-table">
  <table border="1" cellspacing="0" cellpadding="5">
    <thead>
      <tr>
        <th>ID</th>
        <th>Name</th>
        <th>Brand</th>
        <th>Category</th>
        <th>Company</th>
        <th>Price</th>
        <th>Stock</th>
        <th>Mfg Date</th>
        <th>Exp Date</th>
        <th>Supplier</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for med in filter.qs %}
      <tr>
        <td>{{ med.medicine_id }}</td>
        <td>{{ med.name }}</td>
        <td>{{ med.brand_name }}</td>
        <td>{{ med.category }}</td>
        <td>{{ med.company }}</td>
        <td>{{ med.price }}</td>
        <td>
          {% if med.stock_qty <= 0 %}
            Out of Stock
          {% else %}
            {{ med.stock_qty }}
          {% endif %}
        </td>
        <td>{{ med.mfg_date }}</td>
        <td>
          {% if med.exp_date < today %}
            Expired
          {% else %}
            {{ med.exp_date }}
          {% endif %}
        </td>
        <td>{{ med.supplier }}</td>
        <td>
          <a href="{% url 'medicine_detail' med.pk %}">View</a> |
          <a href="{% url 'medicine_edit' med.pk %}">Edit</a> |
          <a href="{% url 'medicine_delete' med.pk %}"
             onclick="return confirm('Are you sure you want to delete this medicine?');">Delete</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="11">No medicines available</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Print Script -->
<script>
  function printTable() {
    var divContents = document.getElementById("medicine-table").innerHTML;
    var printWindow = window.open("", "", "height=600,width=900");
    printWindow.document.write("<html><head><title>Medicine Inventory</title></head><body>");
    printWindow.document.write("<h2>Medicine Inventory</h2>");
    printWindow.document.write(divContents);
    printWindow.document.write("</body></html>");
    printWindow.document.close();
    printWindow.print();
  }
</script>
{% endblock %}
